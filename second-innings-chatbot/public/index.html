<!--
  Second Innings Chatbot Widget
  Embed this in your Wix site using: Add Elements > Embed > Custom Code (HTML iframe)
  
  IMPORTANT: Update the WORKER_URL below to your deployed Cloudflare Worker URL
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      background: transparent;
      height: 100vh;
      display: flex;
      flex-direction: column;
      color: #1a1a2e;
    }

    /* ---- Chat Container ---- */
    .chat-container {
      display: flex;
      flex-direction: column;
      height: 100%;
      max-height: 600px;
      border-radius: 16px;
      overflow: hidden;
      background: #fafbfc;
      box-shadow: 0 8px 40px rgba(0, 0, 0, 0.08), 0 1px 3px rgba(0, 0, 0, 0.04);
      border: 1px solid rgba(0, 0, 0, 0.06);
    }

    /* ---- Header ---- */
    .chat-header {
      background: linear-gradient(135deg, #2d6a4f 0%, #40916c 100%);
      color: white;
      padding: 18px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
    }

    .header-avatar {
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      flex-shrink: 0;
    }

    .header-info h3 {
      font-size: 15px;
      font-weight: 600;
      letter-spacing: -0.01em;
    }

    .header-info p {
      font-size: 12px;
      opacity: 0.85;
      margin-top: 1px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      background: #95d5b2;
      border-radius: 50%;
      display: inline-block;
      margin-right: 4px;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }
    }

    /* ---- Messages Area ---- */
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 20px 16px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      scroll-behavior: smooth;
    }

    .chat-messages::-webkit-scrollbar {
      width: 5px;
    }

    .chat-messages::-webkit-scrollbar-track {
      background: transparent;
    }

    .chat-messages::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 10px;
    }

    .message {
      display: flex;
      gap: 8px;
      max-width: 88%;
      animation: messageIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }

    @keyframes messageIn {
      from {
        opacity: 0;
        transform: translateY(8px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.user {
      align-self: flex-end;
      flex-direction: row-reverse;
    }

    .message.assistant {
      align-self: flex-start;
    }

    .message-avatar {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      flex-shrink: 0;
      margin-top: 2px;
    }

    .message.assistant .message-avatar {
      background: linear-gradient(135deg, #2d6a4f, #40916c);
      color: white;
    }

    .message.user .message-avatar {
      background: #e8edf2;
      color: #5a6977;
    }

    .message-bubble {
      padding: 10px 14px;
      border-radius: 14px;
      font-size: 14px;
      line-height: 1.55;
      letter-spacing: -0.005em;
    }

    .message.assistant .message-bubble {
      background: white;
      color: #1a1a2e;
      border: 1px solid rgba(0, 0, 0, 0.06);
      border-bottom-left-radius: 4px;
    }

    .message.user .message-bubble {
      background: linear-gradient(135deg, #2d6a4f, #40916c);
      color: white;
      border-bottom-right-radius: 4px;
    }

    /* ---- Typing Indicator ---- */
    .typing-indicator {
      display: flex;
      gap: 4px;
      padding: 4px 0;
      align-items: center;
    }

    .typing-indicator span {
      width: 7px;
      height: 7px;
      background: #94a3b8;
      border-radius: 50%;
      animation: typing 1.4s ease-in-out infinite;
    }

    .typing-indicator span:nth-child(2) {
      animation-delay: 0.15s;
    }

    .typing-indicator span:nth-child(3) {
      animation-delay: 0.3s;
    }

    @keyframes typing {

      0%,
      60%,
      100% {
        transform: translateY(0);
        opacity: 0.4;
      }

      30% {
        transform: translateY(-6px);
        opacity: 1;
      }
    }

    /* ---- Input Area ---- */
    .chat-input-area {
      padding: 14px 16px;
      border-top: 1px solid rgba(0, 0, 0, 0.06);
      background: white;
      flex-shrink: 0;
    }

    .input-wrapper {
      display: flex;
      gap: 8px;
      align-items: flex-end;
    }

    .chat-input {
      flex: 1;
      border: 1.5px solid #e2e8f0;
      border-radius: 12px;
      padding: 10px 14px;
      font-size: 14px;
      font-family: inherit;
      resize: none;
      outline: none;
      max-height: 100px;
      line-height: 1.4;
      transition: border-color 0.2s;
      color: #1a1a2e;
    }

    .chat-input:focus {
      border-color: #40916c;
    }

    .chat-input::placeholder {
      color: #94a3b8;
    }

    .send-btn {
      width: 40px;
      height: 40px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, #2d6a4f, #40916c);
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.15s, opacity 0.15s;
      flex-shrink: 0;
    }

    .send-btn:hover {
      transform: scale(1.05);
    }

    .send-btn:active {
      transform: scale(0.95);
    }

    .send-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none;
    }

    .send-btn svg {
      width: 18px;
      height: 18px;
    }

    /* ---- Suggested Questions ---- */
    .suggestions {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 10px;
    }

    .suggestion-chip {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      color: #166534;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.15s;
      white-space: nowrap;
    }

    .suggestion-chip:hover {
      background: #dcfce7;
      border-color: #86efac;
    }

    .powered-by {
      text-align: center;
      padding: 6px;
      font-size: 10px;
      color: #94a3b8;
      background: white;
      flex-shrink: 0;
    }
  </style>
</head>

<body>

  <div class="chat-container">
    <!-- Header -->
    <div class="chat-header">
      <div class="header-avatar">ðŸŒ±</div>
      <div class="header-info">
        <h3>Second Innings Assistant</h3>
        <p><span class="status-dot"></span>Ask me anything</p>
      </div>
    </div>

    <!-- Messages -->
    <div class="chat-messages" id="chatMessages">
      <div class="message assistant">
        <div class="message-avatar">ðŸŒ±</div>
        <div>
          <div class="message-bubble">
            Hi! I'm the Second Innings assistant. I can answer questions about our organization, our founder Love
            Bajpai, our courses, and how to get involved. What would you like to know?
          </div>
          <div class="suggestions" id="suggestions">
            <button class="suggestion-chip" onclick="askSuggestion(this)">Who founded Second Innings?</button>
            <button class="suggestion-chip" onclick="askSuggestion(this)">What courses do you offer?</button>
            <button class="suggestion-chip" onclick="askSuggestion(this)">How can I get involved?</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Input -->
    <div class="chat-input-area">
      <div class="input-wrapper">
        <textarea class="chat-input" id="chatInput" placeholder="Type your question..." rows="1"
          onkeydown="handleKeydown(event)" oninput="autoResize(this)"></textarea>
        <button class="send-btn" id="sendBtn" onclick="sendMessage()" disabled>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
        </button>
      </div>
    </div>

    <div class="powered-by">Powered by Second Innings</div>
  </div>

  <script>
    // =============================================================
    // CONFIGURATION â€” Update this URL after deploying your Worker
    // =============================================================
    const WORKER_URL = "https://second-innings-chatbot.oursecondinnings.workers.dev";

    // =============================================================
    // STATE
    // =============================================================
    let conversationHistory = [];
    let isLoading = false;

    const messagesEl = document.getElementById("chatMessages");
    const inputEl = document.getElementById("chatInput");
    const sendBtn = document.getElementById("sendBtn");

    // Enable/disable send button based on input
    inputEl.addEventListener("input", () => {
      sendBtn.disabled = inputEl.value.trim().length === 0 || isLoading;
    });

    // Auto-resize textarea
    function autoResize(el) {
      el.style.height = "auto";
      el.style.height = Math.min(el.scrollHeight, 100) + "px";
    }

    // Enter to send, Shift+Enter for newline
    function handleKeydown(e) {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        if (!sendBtn.disabled) sendMessage();
      }
    }

    // Handle suggestion chip click
    function askSuggestion(chip) {
      inputEl.value = chip.textContent;
      sendBtn.disabled = false;
      // Remove suggestions after use
      const suggestionsEl = document.getElementById("suggestions");
      if (suggestionsEl) suggestionsEl.remove();
      sendMessage();
    }

    // Add a message to the chat
    function addMessage(role, content) {
      const msgDiv = document.createElement("div");
      msgDiv.className = `message ${role}`;

      const avatar = document.createElement("div");
      avatar.className = "message-avatar";
      avatar.textContent = role === "assistant" ? "ðŸŒ±" : "ðŸ‘¤";

      const bubble = document.createElement("div");
      bubble.className = "message-bubble";
      bubble.textContent = content;

      msgDiv.appendChild(avatar);
      msgDiv.appendChild(bubble);
      messagesEl.appendChild(msgDiv);
      messagesEl.scrollTop = messagesEl.scrollHeight;

      return msgDiv;
    }

    // Show typing indicator
    function showTyping() {
      const msgDiv = document.createElement("div");
      msgDiv.className = "message assistant";
      msgDiv.id = "typingIndicator";

      const avatar = document.createElement("div");
      avatar.className = "message-avatar";
      avatar.textContent = "ðŸŒ±";

      const bubble = document.createElement("div");
      bubble.className = "message-bubble";
      bubble.innerHTML = `<div class="typing-indicator"><span></span><span></span><span></span></div>`;

      msgDiv.appendChild(avatar);
      msgDiv.appendChild(bubble);
      messagesEl.appendChild(msgDiv);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    function hideTyping() {
      const el = document.getElementById("typingIndicator");
      if (el) el.remove();
    }

    // Send message to the Worker
    async function sendMessage() {
      const text = inputEl.value.trim();
      if (!text || isLoading) return;

      isLoading = true;
      sendBtn.disabled = true;
      inputEl.value = "";
      inputEl.style.height = "auto";

      // Remove suggestions if still visible
      const suggestionsEl = document.getElementById("suggestions");
      if (suggestionsEl) suggestionsEl.remove();

      // Show user message
      addMessage("user", text);
      conversationHistory.push({ role: "user", content: text });

      // Show typing indicator
      showTyping();

      try {
        const response = await fetch(WORKER_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            message: text,
            history: conversationHistory.slice(0, -1), // Exclude current message (worker adds it)
          }),
        });

        const data = await response.json();
        hideTyping();

        if (data.error) {
          addMessage("assistant", "Sorry, I encountered an issue. Please try again.");
        } else {
          addMessage("assistant", data.reply);
          conversationHistory.push({ role: "assistant", content: data.reply });
        }
      } catch (err) {
        hideTyping();
        addMessage("assistant", "Sorry, I couldn't connect. Please check your internet connection and try again.");
      }

      isLoading = false;
      sendBtn.disabled = inputEl.value.trim().length === 0;
      inputEl.focus();
    }
  </script>

</body>

</html>